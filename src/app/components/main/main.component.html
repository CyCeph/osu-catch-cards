<div class="container">
  <div class="column">
    <div class="search-section">
      <div class="search-bar">
        <input
          #usersearch
          (keyup.enter)="search()"
          class="search-input"
          type="text"
          [placeholder]="dataLoading ? 'Loading database...' : 'Enter osu! username...'"
          [disabled]="dataLoading"
          aria-label="Search for osu! user"
        />
        <button
          (click)="search()"
          class="btn btn-primary"
          [disabled]="dataLoading"
          aria-label="Search"
        >
          <span class="btn-text">{{ dataLoading ? 'Loading...' : 'Search' }}</span>
        </button>
        <button
          (click)="downloadImage()"
          class="btn btn-secondary"
          [disabled]="!activeUser"
          aria-label="Download card"
        >
          <span class="btn-text">Download</span>
        </button>
      </div>

      <!-- Error Messages -->
      <div class="error-message" *ngIf="searchError" role="alert">
        {{ searchError }}
      </div>
      <div class="error-message" *ngIf="downloadError" role="alert">
        {{ downloadError }}
      </div>

      <!-- Loading State -->
      <div class="loading-container" *ngIf="loading">
        <div class="spinner"></div>
        <p>Loading user data...</p>
      </div>
    </div>

    <!-- User Card -->
    <div class="card-container" *ngIf="activeUser && userCountry && !loading">
      <div class="card-flip" [class.flipped]="cardFlipped">
        <div class="card-back">
          <img src="assets/backside.png" alt="Card back" class="card-back-image">
        </div>
        <div class="card-front">
          <canvas
            #cardCanvas
            class="card-canvas"
            [attr.aria-label]="'Card for ' + activeUser.username"
          ></canvas>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!activeUser && !loading && !searchError && !dataLoading">
      <div class="empty-state-content">
        <h2>Welcome to osu! Catch Cards</h2>
        <p>Search for a player to generate their stats card</p>
      </div>
    </div>

    <!-- Database Loading State -->
    <div class="loading-container" *ngIf="dataLoading && !searchError">
      <div class="spinner"></div>
      <p>Loading player database from spreadsheet...</p>
      <p class="data-info" *ngIf="Users.length > 0">{{ Users.length }} players loaded so far...</p>
    </div>

    <!-- Data Info -->
    <div class="data-info-bar" *ngIf="!dataLoading && Users.length > 0 && !activeUser">
      <p>{{ Users.length }} players in database</p>
    </div>
  </div>
</div>

<div id="download" aria-hidden="true">
  <a #downloadLink></a>
</div>
